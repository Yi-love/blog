<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta charset="UTF-8">
<meta name="apple-mobile-web-app-title" content="xhrp--Promise封装的ajax库">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no">
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<link rel="stylesheet" href="/blog/stylesheets/normalize.css">
<link rel="stylesheet" href="/blog/stylesheets/base.css">
<link rel="stylesheet" href="/blog/stylesheets/monokai.css">
<script src="/blog/javascripts/base.js"></script>
<title>xhrp--Promise封装的ajax库</title>
</head>
<body>
	<div class="j-container-fluid j-header">
	<div class="j-row">
		<div class="j-container">
			<h1 class="j-logo"><a href="/blog/"><img src="/blog/images/logo.png" /> </a></h1>
			<nav class="j-row j-nav">
				<a href="/blog/">首页</a>
				<a href="/blog/list.html">归档</a>
				<a href="https://github.com/Yi-love">Github</a>
				<a href="/blog/me.html">Me</a>
				<a href="http://blog.csdn.net/yjy188" target="_blank">CSDN</a>
			</nav>
		</div>
	</div>
</div>
	<div class="j-container">
		<div class="j-row">
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-9">
				<div class="j-container j-content">
					<h2 class="j-i-title"><a href="javascript:void(0)" title="xhrp--Promise封装的ajax库">xhrp--Promise封装的ajax库</a></h2>
						<p class="j-i-time">22 Mar 2016</p>
						<p class="j-i-tags">
							
							<span class="j-i-tag">XMLHttpRequest</span>
							
							<span class="j-i-tag">Promise</span>
							
							<span class="j-i-tag">前端</span>
							
							<span class="j-i-tag">ajax</span>
							
							<span class="j-i-tag">jsonp</span>
							
						</p>
						<div class="j-container">
							<div class="j-row j-artclie-txt"><blockquote>
  <p>XHRP就好比jquery的ajax模块一样,但是他更贴近：fetch(一个前端ajax库)。目标就是脱离jquery，模块化。</p>
</blockquote>

<blockquote>
  <p>由于 XHRP API 是基于 Promise 设计，有必要先学习一下 Promise，推荐阅读 MDN Promise 教程 。旧浏览器不支持 Promise，可以使用 es6-promise 。
以下我也给出了我的解决方法。</p>
</blockquote>

<blockquote>
  <h4 id="section">参考：</h4>
  <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise</a></p>
</blockquote>

<blockquote>
  <p><a href="https://github.com/github/fetch">https://github.com/github/fetch</a></p>
</blockquote>

<h3 id="section-1">知识要点</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js">   <span class="nx">ajax</span>
   <span class="nx">jsonp</span>
   <span class="nx">ie8</span><span class="err">兼容</span>
   <span class="nx">Promise</span>  <span class="c1">//重点</span></code></pre></figure>

<h3 id="url">文件url</h3>
<p><a href="https://github.com/Yi-love/xhr-promise/blob/master/public/javascripts/xhr.promise.js">https://github.com/Yi-love/xhr-promise/blob/master/public/javascripts/xhr.promise.js</a></p>

<h3 id="xhrpromise">xhr.promise依赖模块</h3>
<p>1.IE8兼容Array依赖</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://github.com/Yi-love/xhr-promise/blob/master/public/javascripts/fix.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script&gt;</span></code></pre></figure>

<p>2.IE系列Promise依赖</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"https://github.com/Yi-love/xhr-promise/blob/master/public/javascripts/npo.src.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script&gt;</span></code></pre></figure>

<h3 id="section-2">外部接口</h3>
<p>xhr.promise 提供3个接口</p>

<blockquote>
  <p>ajax ：普通的ajax处理普通的ajax请求</p>
</blockquote>

<blockquote>
  <p>jsonp : 处理跨域的jsonp请求</p>
</blockquote>

<blockquote>
  <p>abort : 中断请求</p>
</blockquote>

<h3 id="section-3">1.参数说明</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">type</span> <span class="p">:</span><span class="s1">'GET'</span><span class="p">,</span>       <span class="c1">//请求类型</span>
  <span class="nx">xhr</span> <span class="err">:</span> <span class="kd">function</span><span class="p">(){</span>  <span class="c1">//xhr</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">crossDomain</span><span class="err">:</span> <span class="kc">false</span><span class="p">,</span><span class="c1">//是否跨域</span>
  <span class="nx">timeout</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">//超时设置默认不超时</span>
  <span class="nx">processData</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//数据需要被序列化</span>
  <span class="nx">cache</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>       <span class="c1">//对get请求数据进行缓存</span>
  <span class="nx">data</span> <span class="err">：</span> <span class="p">{}</span> <span class="p">,</span>       <span class="c1">//数据</span>
  <span class="nx">jsonp</span> <span class="err">:</span> <span class="s1">'callback'</span><span class="p">,</span><span class="c1">//跨域请求默认参数</span>
  <span class="nx">username</span><span class="err">:</span> <span class="s1">''</span><span class="p">,</span>     <span class="c1">//用户名</span>
  <span class="nx">password</span> <span class="err">:</span> <span class="s1">''</span>     <span class="c1">//密码</span>
<span class="p">}</span></code></pre></figure>

<h3 id="xhrp">2.XHRP使用</h3>

<h4 id="ajax">1.ajax调用</h4>
<p>普通的ajax请求。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">   <span class="nx">XHRP</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span><span class="s1">'post'</span><span class="p">,</span>
        <span class="na">url</span> <span class="p">:</span> <span class="s1">'/ajax/'</span><span class="p">,</span>
        <span class="na">data</span> <span class="p">:</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span><span class="s1">'jin'</span><span class="p">,</span><span class="na">pwd</span><span class="p">:</span><span class="s1">'123213213'</span><span class="p">}</span>
   <span class="p">});</span></code></pre></figure>

<h4 id="jsonp">2.jsonp调用</h4>
<p>通过jsop接口调用，也可以通过ajax调用,凡是在参数列表中存在jsonp参数，都将会以jsonp的方式请求数据。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">   <span class="nx">XHRP</span><span class="p">.</span><span class="nx">jsonp</span><span class="p">({</span>
       <span class="na">url</span> <span class="p">:</span> <span class="s1">'www.exp.com/jsonp'</span><span class="p">,</span>
       <span class="na">data</span> <span class="p">:</span> <span class="p">{</span><span class="na">user</span><span class="p">:</span><span class="s1">'jin'</span><span class="p">},</span>
       <span class="na">jsonp</span> <span class="p">:</span> <span class="s1">'jsonp'</span><span class="c1">//服务器接收跨域请求的参数</span>
   <span class="p">});</span>
   <span class="c1">//or</span>
   <span class="nx">XHRP</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
       <span class="na">url</span> <span class="p">:</span> <span class="s1">'www.exp.com/jsonp'</span><span class="p">,</span>
       <span class="na">data</span> <span class="p">:</span> <span class="p">{</span><span class="na">user</span><span class="p">:</span><span class="s1">'jin'</span><span class="p">},</span>
       <span class="na">jsonp</span> <span class="p">:</span> <span class="s1">'jsonp'</span><span class="c1">//服务器接收跨域请求的参数</span>
   <span class="p">});</span></code></pre></figure>

<h4 id="abort">3.abort中断</h4>
<p>手动想中断请求。可能设置在参数中传人<em>timeout</em>参数是一个更好的选择。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">   <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">XHRP</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span><span class="s1">'post'</span><span class="p">,</span>
        <span class="na">url</span> <span class="p">:</span> <span class="s1">'/ajax/'</span><span class="p">,</span>
        <span class="na">data</span> <span class="p">:</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span><span class="s1">'jin'</span><span class="p">,</span><span class="na">pwd</span><span class="p">:</span><span class="s1">'123213213'</span><span class="p">}</span>
   <span class="p">});</span>
   <span class="nx">promise</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span><span class="c1">//手动中断</span>
   
   <span class="c1">//设置timeout参数</span>
   <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">XHRP</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span><span class="s1">'post'</span><span class="p">,</span>
        <span class="na">url</span> <span class="p">:</span> <span class="s1">'/ajax/'</span><span class="p">,</span>
        <span class="na">data</span> <span class="p">:</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span><span class="s1">'jin'</span><span class="p">,</span><span class="na">pwd</span><span class="p">:</span><span class="s1">'123213213'</span><span class="p">},</span>
        <span class="na">timeout</span> <span class="p">:</span> <span class="mi">2000</span> <span class="c1">//2s后中断请求</span>
   <span class="p">});</span>
   </code></pre></figure>

<h3 id="section-4">3.返回值</h3>
<p>XHRP返回的是一个Promise对象实例。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">   <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">XHRP</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({});</span></code></pre></figure>

<h3 id="section-5">参考文档</h3>
<p><a href="http://liubin.org/promises-book">JavaScript Promise迷你书（中文版）</a></p>

</div>
						</div>
				</div>
			</div>
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-3">
	<div class="j-user">
		<div class="j-user-thumb">
			<a href="/blog/me.html"><img src="/blog/images/user.jpg" alt="" /></a>
		</div>
		<div class="j-user-name"><h3>Jin</h3></div>
		<div class="j-user-info">
			<a href="/blog/me.html">微信</a>
			<a href="/blog/me.html">微博</a>
			<a href="/blog/me.html">QQ</a>
		</div>
	</div>
	<div class="j-class-list">
		<h3 class="j-row">分类</h3>
		
		<a href="/blog/category.html?category=笔记">笔记 <span class="j-class-i-num">(16)</span></a>
		
		<a href="/blog/category.html?category=JavaScript">JavaScript <span class="j-class-i-num">(11)</span></a>
		
		<a href="/blog/category.html?category=bee.js">bee.js <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=Promise">Promise <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=工具">工具 <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=Git">Git <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=vim">vim <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=gulp">gulp <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=Node">Node <span class="j-class-i-num">(1)</span></a>
		
	</div>
</div>
		</div>
	</div>
	<div class="j-container-fluid j-footer">
	<div class="j-container">
		<p class="j-footer-say">喜欢一个人需要理由吗？需要吗？不需要吗？需要吗？……</p>
		<p class="j-footer-say j-tlgr">——周星驰 《大话西游》</p>
	</div>
</div>
<div class="j-tips-box">
	<div class="j-tips-max-box" onclick="fullScreen()">
		<span class="l-t"></span>
		<span class="r-t"></span>
		<span class="l-b"></span>
		<span class="r-b"></span>
	</div>
	<div class="j-tips-top-box">
		<a href="javascript:window.scrollTo(0,0)" class="j-tip-top"><span class="l-bar"></span><span class="r-bar"></span></a>
	</div>
</div>
</body>
</html>