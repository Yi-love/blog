<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta charset="UTF-8">
<meta name="apple-mobile-web-app-title" content="Redux 主要知识点与实战案例">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no">
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<link rel="stylesheet" href="/blog/stylesheets/normalize.css">
<link rel="stylesheet" href="/blog/stylesheets/base.css">
<link rel="stylesheet" href="/blog/stylesheets/monokai.css">
<script src="/blog/javascripts/base.js"></script>
<title>Redux 主要知识点与实战案例</title>
</head>
<body>
	<div class="j-container-fluid j-header">
	<div class="j-row">
		<div class="j-container">
			<h1 class="j-logo"><a href="/blog/"><img src="/blog/images/logo.png" /> </a></h1>
			<nav class="j-row j-nav">
				<a href="/blog/">首页</a>
				<a href="/blog/list.html">归档</a>
				<a href="https://github.com/Yi-love">Github</a>
				<a href="/blog/me.html">Me</a>
				<a href="http://blog.csdn.net/yjy188" target="_blank">CSDN</a>
			</nav>
		</div>
	</div>
</div>
	<div class="j-container">
		<div class="j-row">
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-9">
				<div class="j-container j-content">
					<h2 class="j-i-title"><a href="javascript:void(0)" title="Redux 主要知识点与实战案例">Redux 主要知识点与实战案例</a></h2>
						<p class="j-i-time">11 Apr 2016</p>
						<p class="j-i-tags">
							
							<span class="j-i-tag">redex</span>
							
							<span class="j-i-tag">react</span>
							
							<span class="j-i-tag">redux-thunk</span>
							
						</p>
						<div class="j-container">
							<div class="j-row j-artclie-txt"><h3 id="redux">什么是Redux</h3>
<p>每一个中间件的出现都是为了解决某个问题而来。redux 就是为了解决state的不可测而生，redux试图让state变得可预测。</p>

<h3 id="redux-3">Redux 的3大原则</h3>

<h4 id="section">1.单一数据源</h4>
<p>所有的state都会被存放到一个object对象树中，并且object只存在于唯一一个state中</p>

<h4 id="state">2. State是只读的</h4>
<p>唯一能改变state的方法就是通过action触发，action 只是描述了有事情发生了这一事实，并没有指明应用如何更新 state–reducer才是。</p>

<h4 id="reducerstate">3. reducer修改state</h4>
<p>reducer就是一个函数，接收旧的 state 和 action，返回新的 state。</p>

<p>reducer 纯净非常重要。永远不要在 reducer 里做这些操作：</p>

<blockquote>
  <ol>
    <li>修改传入参数；</li>
    <li>执行有副作用的操作，如 API 请求和路由跳转；</li>
    <li>调用非纯函数，如 Date.now() 或 Math.random()。</li>
  </ol>
</blockquote>

<h3 id="redux-vs-flux">Redux VS Flux</h3>
<p>Flux:是Facebook用户建立客户端Web应用的前端架构， 它通过利用一个单向的数据流补充了React的组合视图组件，这更是一种模式而非正式框架，你能够无需许多新代码情况下立即开始使用Flux。</p>

<p>了解更多关于Fulx:</p>

<p><a href="http://reactjs.cn/react/docs/flux-overview.html">Flux应用框架</a></p>

<p>共同点：</p>

<blockquote>
  <ol>
    <li>将模型的更新逻辑全部集中于一个特定的层( Flux 里的 store，Redux 里的 reducer )</li>
    <li>Flux 和 Redux 都不允许程序直接修改数据，而是用一个叫作 “action” 的普通对象来对更改进行描述。</li>
  </ol>
</blockquote>

<p>区别：</p>

<blockquote>
  <ol>
    <li>Redux 并没有 dispatcher 的概念。原因是它依赖纯函数(reducer)来替代事件处理器.</li>
    <li>Redux 设想你永远不会变动你的数据</li>
  </ol>
</blockquote>

<h3 id="section-1">基础</h3>

<h4 id="action">1.Action</h4>
<p>Action 只是描述了有事情发生了这一事实；
是把数据从应用传到 store 的有效载荷。它是 store 数据的唯一来源。一般来说你会通过 store.dispatch() 将 action 传到 store。</p>

<p>注意点：</p>

<blockquote>
  <ol>
    <li>Action 本质上是 JavaScript 普通对象</li>
    <li>约定，action 内使用一个字符串类型的 type 字段来表示将要执行的动作</li>
    <li>尽量减少在 action 中传递的数据</li>
    <li>创建函数 就是生成 action 的方法(注意：export 出去)</li>
  </ol>
</blockquote>

<h4 id="reducer">2.Reducer</h4>
<p>指明应用如何更新 state。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="c1">//reducer 就是一个函数，接收旧的 state 和 action，返回新的 state。</span>
  <span class="p">(</span><span class="nx">previousState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">newState</span></code></pre></figure>

<p>要点：</p>

<blockquote>
  <ol>
    <li>尽可能地把 state 范式化，不存在嵌套。把所有数据放到一个对象里，每个数据以 ID 为主键，不同数据相互引用时通过 ID 来查找.</li>
    <li>reducer 一定要保持纯净。只要传入参数一样，返回必须一样。没有特殊情况、没有副作用，没有 API 请求、没有修改参数，单纯执行计算.</li>
    <li>不要修改 state</li>
    <li>在 default 情况下返回旧的 state</li>
    <li>switch 语句并不是严格意义上的样板代码.</li>
    <li>reducer 合成，它是开发 Redux 应用最基础的模式。</li>
    <li>每个 reducer 只负责管理全局 state 中它负责的一部分。每个 reducer 的 state 参数都不同，分别对应它管理的那部分 state 数据。</li>
  </ol>
</blockquote>

<h4 id="combinereducers">2.1 combineReducers</h4>
<p>把一个由多个不同 reducer 函数作为 value 的 object，合并成一个最终的 reducer 函数，然后就可以对这个 reducer 调用 createStore.</p>

<p>换句话就是：</p>

<p>combineReducers() 所做的只是生成一个函数，这个函数来调用你的一系列 reducer，
每个 reducer 根据它们的 key 来筛选出 state 中的一部分数据并处理，然后这个生成的函数所所有 reducer 的结果合并成一个大的对象。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="kr">import</span> <span class="p">{</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redux'</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">todoApp</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
    <span class="nx">visibilityFilter</span><span class="p">,</span>
    <span class="nx">todos</span>
  <span class="p">});</span>
  <span class="kr">export</span> <span class="k">default</span> <span class="nx">todoApp</span><span class="p">;</span>
  <span class="c1">// 完全等价</span>
  <span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">todoApp</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">visibilityFilter</span><span class="p">:</span> <span class="nx">visibilityFilter</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">visibilityFilter</span><span class="p">,</span> <span class="nx">action</span><span class="p">),</span>
      <span class="na">todos</span><span class="p">:</span> <span class="nx">todos</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span></code></pre></figure>

<h4 id="store">3. Store</h4>
<p>Store 就是把Action 和 Reducer联系到一起的对象。Store 有以下职责：</p>

<blockquote>
  <ol>
    <li>维持应用的 state；</li>
    <li>提供 getState() 方法获取 state；</li>
    <li>提供 dispatch(action) 方法更新 state；</li>
    <li>通过 subscribe(listener) 注册监听器。</li>
  </ol>
</blockquote>

<p>创建方式：</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="kr">import</span> <span class="p">{</span> <span class="nx">createStore</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redux'</span>
  <span class="kr">import</span> <span class="nx">todoApp</span> <span class="nx">from</span> <span class="s1">'./reducers'</span>
  <span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">todoApp</span><span class="p">)</span></code></pre></figure>

<h4 id="createstore">3.1 createStore</h4>
<p>接收2个参数：一个是当前action ,以及初始化是的state.state可选。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="p">[</span><span class="nx">initialState</span><span class="p">])</span></code></pre></figure>

<h4 id="section-2">4.数据流</h4>
<p>严格的单向数据流是 Redux 架构的设计核心。</p>

<p>这意味着应用中所有的数据都遵循相同的生命周期，这样可以让应用变得更加可预测且容易理解。同时也鼓励做数据范式化，这样可以避免使用多个且独立的无法相互引用的重复数据。</p>

<p>Redux 应用中数据的生命周期遵循下面 4 个步骤：</p>

<blockquote>
  <ol>
    <li>调用 store.dispatch(action)。</li>
    <li>Redux store 调用传入的 reducer 函数。</li>
    <li>根 reducer 应该把多个子 reducer 输出合并成一个单一的 state 树。(使用：combineReducers())</li>
    <li>Redux store 保存了根 reducer 返回的完整 state 树。</li>
  </ol>
</blockquote>

<h3 id="redux-1">Redux使用场景</h3>
<p>Redux 和 React 之间没有关系。Redux 支持 React、Angular、Ember、jQuery 甚至纯 JavaScript。</p>

<p>Redux 还是和 React 和 Deku 这类框架搭配起来用最好，因为这类框架允许你以 state 函数的形式来描述界面，Redux 通过 action 的形式来发起 state 变化。</p>

<h3 id="section-3">参考文档</h3>

<p><a href="http://camsong.github.io/redux-in-chinese/index.html">Redux 中文文档</a></p>

<p><a href="https://github.com/matthew-andrews/isomorphic-fetch">isomorphic-fetch Ajax请求</a></p>

<p><a href="http://koa.bootcss.com/">koa服务器</a></p>

<p><a href="http://babeljs.io/repl/">babel编译</a></p>

<p><a href="http://www.infoq.com/cn/articles/react-and-webpack?utm_source=tuicool">webpack打包</a></p>

<p><a href="https://fakefish.github.io/react-webpack-cookbook/index.html">webpack英文原版</a></p>

<p><a href="https://github.com/gaearon/redux-thunk">redux-thunk异步编程</a></p>

<p><a href="http://www.ruanyifeng.com/blog/2015/03/react.html">React 入门实例教程</a></p>

<p><a href="https://github.com/hung-phan/koa-react-isomorphic/">koa-react-isomorphic案例源码分析</a></p>

</div>
						</div>
				</div>
			</div>
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-3">
	<div class="j-user">
		<div class="j-user-thumb">
			<a href="/blog/me.html"><img src="/blog/images/user.jpg" alt="" /></a>
		</div>
		<div class="j-user-info">
			<a href="/blog/me.html">微信</a>
			<a href="/blog/me.html">微博</a>
			<a href="/blog/me.html">QQ</a>
		</div>
	</div>
	<div class="j-class-list">
		<h3 class="j-row">分类</h3>
		
		<a href="/blog/category.html?category=笔记">笔记 <span class="j-class-i-num">(16)</span></a>
		
		<a href="/blog/category.html?category=JavaScript">JavaScript <span class="j-class-i-num">(11)</span></a>
		
		<a href="/blog/category.html?category=bee.js">bee.js <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=Promise">Promise <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=工具">工具 <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=Git">Git <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=vim">vim <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=gulp">gulp <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=Node">Node <span class="j-class-i-num">(1)</span></a>
		
	</div>
</div>
		</div>
	</div>
	<div class="j-container-fluid j-footer">
	<div class="j-container">
		<p class="j-footer-say">喜欢一个人需要理由吗？需要吗？不需要吗？需要吗？……</p>
		<p class="j-footer-say j-tlgr">——周星驰 《大话西游》</p>
	</div>
</div>

</body>
</html>