<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta charset="UTF-8">
<meta name="apple-mobile-web-app-title" content="gulp 常用命令操作集合">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no">
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
<link rel="stylesheet" href="/blog/stylesheets/normalize.css">
<link rel="stylesheet" href="/blog/stylesheets/base.css">
<link rel="stylesheet" href="/blog/stylesheets/monokai.css">
<script src="/blog/javascripts/base.js"></script>
<title>gulp 常用命令操作集合</title>
</head>
<body>
	<div class="j-container-fluid j-header">
	<div class="j-row">
		<div class="j-container">
			<h1 class="j-logo"><a href="/blog/"><img src="/blog/images/logo.png" /> </a></h1>
			<nav class="j-row j-nav">
				<a href="/blog/">首页</a>
				<a href="/blog/list.html">归档</a>
				<a href="https://github.com/Yi-love">Github</a>
				<a href="/blog/me.html">Me</a>
				<a href="http://blog.csdn.net/yjy188" target="_blank">CSDN</a>
			</nav>
		</div>
	</div>
</div>
	<div class="j-container">
		<div class="j-row">
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-9">
				<div class="j-container j-content">
					<h2 class="j-i-title"><a href="javascript:void(0)" title="gulp 常用命令操作集合">gulp 常用命令操作集合</a></h2>
						<p class="j-i-time">07 Apr 2016</p>
						<p class="j-i-tags">
							
							<span class="j-i-tag">gulp</span>
							
							<span class="j-i-tag">压缩</span>
							
							<span class="j-i-tag">编译</span>
							
						</p>
						<div class="j-container">
							<div class="j-row j-artclie-txt"><p>gulp 作为 grunt之后的打包压缩工具，以其配置简洁而备受青睐。在最近的一个项目里面我有幸使用gulp来编译压缩上线代码。</p>

<p>下面来一起了解gulp的基本命令，极其用法。</p>

<p>gulp里面基本就是以任务（task）的形式完成每一步的操作。gulp 与 grunt 主要的区别在于 。grunt 是基于文件的，而gulp是基于pipe.
在gulp里面定义一个任务很简单。</p>

<p>例如：</p>

<p>下面是校验css的任务。假如需要执行这个任务的时候，只需要打开控制台，进入项目目录。然后执行命令： <em>gulp css</em> 。gulp就好将
指定的目录下的css文件编译,压缩。并生成到指定的目录。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre> <span class="cm">/**
 * [css 校验]
 * cmd ： gulp css
 * author : jin
 */</span>
 <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'css'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="nx">root</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="s1">'/**/*.css'</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">autoprefixer</span><span class="p">({</span>
      <span class="na">browsers</span><span class="p">:</span> <span class="p">[</span><span class="s1">'last 2 versions'</span><span class="p">,</span> <span class="s1">'safari 5'</span><span class="p">,</span> <span class="s1">'ie 8'</span><span class="p">,</span> <span class="s1">'ie 9'</span><span class="p">,</span> <span class="s1">'opera 12.1'</span><span class="p">,</span> <span class="s1">'ios 6'</span><span class="p">,</span> <span class="s1">'android 4'</span><span class="p">],</span>
        <span class="na">cascade</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//是否美化属性值 默认：true 像这样：</span>
        <span class="c1">//-webkit-transform: rotate(45deg);</span>
        <span class="c1">//transform: rotate(45deg);</span>
        <span class="na">remove</span><span class="p">:</span><span class="kc">true</span> <span class="c1">//是否去掉不必要的前缀 默认：true</span>
      <span class="p">}))</span><span class="c1">//自动添加前缀</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">minifycss</span><span class="p">())</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">changed</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">build</span><span class="p">))</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">build</span><span class="p">))</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'./'</span><span class="p">))</span><span class="c1">//map文件位置</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">build</span><span class="p">))</span>
     <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span><span class="c1">//时时刷新</span>
 <span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="section">基本用法</h3>
<p>gulp最基本的用法主要有：预处理文件编译压缩(如：sass),js文件压缩,image图片压缩，本地时时刷新服务等。
gulp常用插件有以下几种：</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">),</span> <span class="c1">//gulp</span>
	<span class="nx">jshint</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-jshint'</span><span class="p">),</span><span class="c1">//js校验</span>
	<span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-uglify'</span><span class="p">),</span><span class="c1">//压缩</span>
	<span class="nx">concat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-concat'</span><span class="p">),</span><span class="c1">//文件合并</span>
	<span class="nx">sass</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sass'</span><span class="p">),</span><span class="c1">//sass文件编译</span>
	<span class="nx">sourcemaps</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-sourcemaps'</span><span class="p">),</span><span class="c1">//生成.map文件</span>
	<span class="nx">imagemin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-imagemin'</span><span class="p">),</span><span class="c1">//图片压缩</span>
	<span class="nx">pngquant</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'imagemin-pngquant'</span><span class="p">),</span><span class="c1">//图片压缩</span>
	<span class="nx">replace</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-replace-task'</span><span class="p">),</span><span class="c1">//内容替换</span>
	<span class="nx">changed</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-changed'</span><span class="p">),</span><span class="c1">//检测文件内容是否发生变化</span>
	<span class="nx">autoprefixer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-autoprefixer'</span><span class="p">),</span><span class="c1">//css自动加前缀</span>
	<span class="nx">minifycss</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-minify-css'</span><span class="p">),</span><span class="c1">//css压缩</span>
	<span class="nx">includer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-html-ssi'</span><span class="p">),</span><span class="c1">//ssi用法 文件可以使用include引入.服务器语法</span>
	<span class="nx">browserSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'browser-sync'</span><span class="p">);</span><span class="c1">//时时刷新,与 supervisor一起使用效果更好</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<blockquote>
  <p>css压缩上面已经举例，下面就不重新复述了.不过注意sass插件安装喜欢报错，需要注意。需要使用sass编译只需要在css任务前面添加以下代码即可。</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">sass</span><span class="p">.</span><span class="nx">logError</span><span class="p">))</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="js">1. js编译压缩</h3>
<p>压缩主要注意 seajs 等模块管理框架的保留变量不要被压缩，以免产生错误。这次的项目里面就在使用seajs的时候由于没有注意而造成模块引用的时候报错。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="cm">/**
 * 压缩JS
 * cmd : gulp jsminify
 * author : jin
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'jsminify'</span> <span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="nx">root</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="s1">'/**/*.js'</span><span class="p">])</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">())</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">jshint</span><span class="p">.</span><span class="nx">reporter</span><span class="p">(</span><span class="s1">'default'</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">uglify</span><span class="p">({</span>
	  <span class="na">mangle</span><span class="p">:</span> <span class="p">{</span> <span class="c1">//seajs等库文件对 以下这几个变量有要求，不能压缩</span>
	    <span class="na">except</span><span class="p">:</span> <span class="p">[</span><span class="s1">'define'</span><span class="p">,</span> <span class="s1">'require'</span><span class="p">,</span> <span class="s1">'module'</span><span class="p">,</span> <span class="s1">'exports'</span><span class="p">,</span> <span class="s1">'modules'</span><span class="p">]</span>
	  <span class="p">}</span>
	  <span class="p">,</span><span class="na">compress</span><span class="p">:</span> <span class="kc">false</span>
	<span class="p">}))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">changed</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span><span class="na">loadMaps</span><span class="p">:</span> <span class="kc">true</span><span class="p">}))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sourcemaps</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'./'</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="section-1">2.图片压缩</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="cm">/**
 * 图片压缩
 * cmd : gulp imagemin
 * author : jin
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'imagemin'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">([</span><span class="nx">root</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="s1">'/**/images/**/*.*'</span><span class="p">])</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">imagemin</span><span class="p">({</span>
		<span class="na">progressive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">svgoPlugins</span><span class="p">:</span> <span class="p">[{</span><span class="na">removeViewBox</span><span class="p">:</span> <span class="kc">false</span><span class="p">}],</span>
		<span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="nx">pngquant</span><span class="p">()]</span>
	<span class="p">}))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="p">))</span>
	<span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reload</span><span class="p">({</span><span class="na">stream</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="section-2">3.时时刷新</h3>
<p>时时刷新功能可以在写代码的时候可以时时查看效果。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="cm">/**
 * 本地时时刷新服务
 * cmd : gulp server
 * author:jin
 * 与  supervisor  --watch routes,views ./bin/www   效果更好
 */</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'server'</span> <span class="p">,</span> <span class="p">[</span><span class="s1">'dist'</span><span class="p">]</span> <span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">browserSync</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="o">+</span><span class="s1">'/**/*.*'</span> <span class="p">,</span> <span class="p">{</span>
    <span class="na">server</span> <span class="p">:</span> <span class="p">{</span> <span class="na">baseDir</span> <span class="p">:</span> <span class="nx">root</span><span class="p">.</span><span class="nx">dist</span><span class="p">}</span>	<span class="c1">//本地目录</span>
    <span class="c1">// proxy : root.host  //选择代理 , 因为可能需要调用nodejs的模拟接口</span>
  <span class="p">});</span>
  <span class="c1">// 监听开发目录的文件变化 ,随时将变化的文件发送到dist测试目录</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">src</span><span class="o">+</span><span class="s1">'/**/*.*'</span><span class="p">,[</span><span class="s1">'dist'</span><span class="p">]);</span>
  <span class="c1">//监听服务器文件变化</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">'routes/**/*.js'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span> <span class="p">,</span> <span class="nx">reload</span><span class="p">);</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这里存在依赖的任务就是 dist。task任务的第二个参数为当前任务需要依赖的任务。必须等到依赖任务执行完成才能执行。这里的
server任务的依赖任务就是dist任务。
我这里的dist任务是这样定义的。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre> <span class="cm">/**
 * 线上环境任务
 * 任务：复制文件,js压缩,css完善压缩,图片压缩
 */</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'dist'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'copysource'</span><span class="p">],</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">([</span><span class="s1">'jsminify'</span><span class="p">,</span><span class="s1">'css'</span><span class="p">,</span><span class="s1">'imagemin'</span><span class="p">]);</span>
 <span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这里的copysource任务是对其他文件的拷贝.由于简单就不列出了。</p>

<h3 id="section-3">趋势</h3>
<p>不管是gulp , grunt 还是 fis。 没有谁好谁坏，只有谁更适合。这些工具我动使用过，觉得gulp简单容易上手，fis是百度
的，感觉上手能到比grunt要好一点。因为我学习grunt的时候就是因为感觉配置繁琐而放弃，最终转向gulp的 。</p>

<p>而最近我使用的工具 webpack。呵呵！！！！！</p>

<p>工具越来越多，功能越来越强大。我觉得能处理当前面临的问题的工具就是好工具。</p>

<h3 id="section-4">参考文档</h3>

<p><a href="https://segmentfault.com/a/1190000002491282">前端工程的构建工具对比 Gulp vs Grunt</a></p>

<p><a href="http://colobu.com/2014/11/17/gulp-plugins-introduction/#gulp-src%28globs[,_options]%29">gulp plugins 插件介绍 </a></p>
</div>
						</div>
				</div>
			</div>
			<div class="j-col-xs-12 j-col-sm-12 j-col-md-3">
	<div class="j-user">
		<div class="j-user-thumb">
			<a href="/blog/me.html"><img src="/blog/images/user.jpg" alt="" /></a>
		</div>
		<div class="j-user-info">
			<a href="/blog/me.html">微信</a>
			<a href="/blog/me.html">微博</a>
			<a href="/blog/me.html">QQ</a>
		</div>
	</div>
	<div class="j-class-list">
		<h3 class="j-row">分类</h3>
		
		<a href="/blog/category.html?category=笔记">笔记 <span class="j-class-i-num">(15)</span></a>
		
		<a href="/blog/category.html?category=JavaScript">JavaScript <span class="j-class-i-num">(10)</span></a>
		
		<a href="/blog/category.html?category=bee.js">bee.js <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=Promise">Promise <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=工具">工具 <span class="j-class-i-num">(3)</span></a>
		
		<a href="/blog/category.html?category=Git">Git <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=vim">vim <span class="j-class-i-num">(1)</span></a>
		
		<a href="/blog/category.html?category=gulp">gulp <span class="j-class-i-num">(1)</span></a>
		
	</div>
</div>
		</div>
	</div>
	<div class="j-container-fluid j-footer">
	<div class="j-container">
		<p class="j-footer-say">喜欢一个人需要理由吗？需要吗？不需要吗？需要吗？……</p>
		<p class="j-footer-say j-tlgr">——周星驰 《大话西游》</p>
	</div>
</div>

</body>
</html>