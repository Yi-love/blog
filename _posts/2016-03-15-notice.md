---
layout: page
title: 2015年度小知识点和技巧笔记
categories: [笔记]
tags: [2015,技巧,个人,前端]
---

>2015年虽然已经过去3个半月，但是想了又想还是觉得有必要把这篇笔记写一下。知识点比较多，就不按时间来咯。

>### 1. 随机取色
{%highlight js%}
  return '#'+(Math.random()*0xffffff<<0).toString(16);
{%endhighlight%}

>##### 扩展
>字符串解析模版
{%highlight js%}
  [].forEach.call($$("*"),function(a){
    a.style.outline="1px solid #"+(~~(Math.random()*(1<<24))).toString(16);
  });
{%endhighlight%}

>### 2.histrory.pushState 无刷新修改地址栏显示地址的方法
>需求：Ajax局部刷新是小菜一碟。但现在每次ajax请求后，在不刷新页面的情况下改变url地址。

>##### 限制
>1.传递的url必须域名相同，不能跨域

>2.state对象虽然可以存储很多自定义的属性，但对于不可序列化的对象则不能存储，如：DOM对象。

{%highlight js%}
  var stateObj = { foo: "bar" };
  history.pushState(stateObj, "page 2", "list.html");
{%endhighlight%}
>比如我现在的页面的url是：http://yi-love.github.io/blog/,我的目标是要让点击Github之后：https://github.com/Yi-love，
>然后点击返回回退到 ： http://yi-love.github.io/blog/list.html 这个页面。

>所以通过ajax我们可以每次都pushState一个json对象。这样就会让用户点击回退的时候可以回退到他之前查询过的页面，而不是一个新的页面。

>##### 其它相关连参数

>1.history.replaceState: 操作类似于history.pushState()，不同之处在于replaceState()方法会修改当前历史记录条目而并非创建新的条目。

>2.window.onpopstate: 是popstate事件在window对象上的事件句柄.每当处于激活状态的历史记录条目发生变化时,popstate事件就会在对应window对象上触发. 

{%highlight js%}
  history.replaceState();
  window.onpopstate = funcg;
{%endhighlight%}
>##### 参考资料
>[histrory.pushState][pushState]

>[window.onpopstate][onpopstate]

[pushState]:https://developer.mozilla.org/zh-CN/docs/DOM/Manipulating_the_browser_history
[onpopstate]: https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate

>### 3.页面性能测试
>[http://www.webpagetest.org/][webpagetest]

[webpagetest]: http://www.webpagetest.org/

>### 4. JSONP IE8兼容
>因为ie8在script元素上没有onload事件。所以只能通过监听script.onreadystatechange判断js是否加载完成。
{%highlight js%}
  script.src = url;
  script.onload = function(){
   //成功
  };
  script.onreadystatechange = function(){ //兼容 ie8
    if (script.readyState === 'loaded' || script.readyState === 'complete' ){
      //成功
    }
  };
  script.onerror = function(){
    //失败
  };
  window[_callbackName] = function(){//callback函数注册到window
    responseData = arguments;
  };
  head.appendChild(script);
{%endhighlight%}

>### 5. 事件触发trigger
>通过js代码触发某个dom元素的事件。
{%highlight js%}
  /**
  * [trigger 触发事件]
  * @param  {[element]} element [目标元素]
  * @param  {[string]} event [需要触发的事件]
  */
  function trigger(element,event){
    if( !(typeof event === 'string')) ) return;
    if ( element.dispatchEvent ){
      var evt = document.createEvent( 'Events' );// initEvent接受3个参数
      evt.initEvent(event, true, true);
      element.dispatchEvent(evt);     
    }else if ( element.fireEvent ){ //IE
      element.fireEvent('on'+event);
    }
  };
{%endhighlight%}

>### 6. JS类型判断
{%highlight js%}
  var class2type = [];
  ;"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(name){
    class2type["[object "+name+"]"] = name.toLowerCase();
  });
  function isType(obj){	return obj == null ? String(obj) : class2type[toString.call(obj)] || 'object'};
  //案例
  isType([]) //"array"
  isType({})//"object"
  isType(null)//"null"
  isType(/\d/g)//"regexp"
  //typeof
  typeof [] //"object"
  typeof {}//"object"
  typeof null//"object"
  typeof /\d/g//"object"
{%endhighlight%}
>#### 扩展
{%highlight js%}
  function likeArray(obj) { return typeof obj.length == 'number' };
  function isDocument(obj)   { return obj != null && obj.nodeType == obj.DOCUMENT_NODE };
  function isWindow(obj) { return obj != null && obj == obj.window };
  function isFunction( value ){	return isType(value) == 'function'};
  function isObject(obj){ return isType(obj) == "object" };
  function isString( obj ){ return isType(obj) == 'string'};
  function isPlainObject(obj) {
    return isObject(obj) && !isWindow(obj) && Object.getPrototypeOf(obj) === Object.prototype;
  }
{%endhighlight%}